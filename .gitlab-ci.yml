# 调试开启
before_script:
  - pwd
  - env

stages:
  - build

build-image:
  stage: build
  script:
    - export BUILD_DATE=`date +%Y%m%d%H%M%S`
    - export IMAGE_NAME=${DOCKER_REGISTRY_USER}/armhf-docker-registry-ui:${BUILD_DATE}
    - echo "IMAGE_NAME ${IMAGE_NAME}"
    - echo "DOCKER_REGISTRY ${DOCKER_REGISTRY}"
    - docker build -t ${IMAGE_NAME} .
    - docker tag ${IMAGE_NAME} ${DOCKER_REGISTRY}/${IMAGE_NAME}
    - docker login -u $DOCKER_REGISTRY_USER -p $DOCKER_REGISTRY_PASSWORD
    - docker push ${IMAGE_NAME}
    - docker push ${DOCKER_REGISTRY}/${IMAGE_NAME}
    - docker rmi ${DOCKER_REGISTRY}/${IMAGE_NAME}
    - docker rmi ${IMAGE_NAME}
  tags:
    - raspberrypi
  when: manual

